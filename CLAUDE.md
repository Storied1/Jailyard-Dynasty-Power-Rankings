# CLAUDE.md — The Jailyard Dynasty Power Rankings

## Quick Context
Static fantasy football dynasty league site (12 teams, est. 2022). Zero dependencies — pure HTML/CSS/JS, inline everything. Data from Sleeper API (cached JSON + live fallback). Glassmorphic dark theme with light toggle.

## Tech Stack
- HTML5 / CSS3 / Vanilla JS (no frameworks, no npm, no build)
- Canvas 2D API for charts (scatter, stacked bar, trend, Elo)
- Python 3 for data pipeline (`fetch_sleeper.py`)
- GitHub Actions for automated weekly data fetches
- Hosted as static files (GitHub Pages or direct)

## Pages
| File | Purpose |
|------|---------|
| `index.html` | Landing — starfield canvas, stat counters, nav cards, Championship Vault |
| `preseason.html` | Preseason rankings — data tables, charts, team cards, rosters |
| `season.html` | Season hub — weekly results, power rankings, trend charts (Sleeper API) |
| `history.html` | League Bible — all-time records, H2H matrix, Elo ratings, franchise profiles |
| `draft.html` | Draft recap — full draft board, grades, storylines |
| `trades.html` | Trade tracker — timeline, season filter, activity chart |
| `week1.html` | Week 1 column — essay, mailbag, matchup picks |
| `config.js` | Central league config — name, Sleeper IDs, colors, nav (edit to rebrand) |

## Data
- `league.teams[]` and `extras{}` in `preseason.html` (inline JS objects)
- `config.js` — league branding, Sleeper IDs, nav links (loaded by all pages)
- `data/` directory (generated by `fetch_sleeper.py`, consumed by season/history pages)
- `data/{year}/season_combined.json` — main season data file
- `data/league_history.json` — cross-season analytics (Elo, H2H, records)
- Sleeper API (`https://api.sleeper.app/v1`) as live fallback

## Critical Rules
- **NEVER touch `dontuse`, `dontuse2`, `dontusedraft3`** — archived legacy files
- **KEEP everything inline** — no external CSS/JS files unless explicitly requested
- **ZERO dependencies** — no npm, no CDN imports, no frameworks
- **Maintain glassmorphic dark theme** — `backdrop-filter`, CSS variables, gradients
- **CSS variables for theming** — all colors via `var(--name)`, `:root` block per file
- **Use `--accent2`** not `--accent-2` (standardized across files)
- **Canvas charts must handle `devicePixelRatio`** for Retina displays
- **Data changes must update all consumers** — if you change `league.teams` schema, grep for every reference

## Known Patterns
- Data loading: try cached JSON → catch → live Sleeper API → catch → error UI
- IIFEs `(function(){ ... })()` for scope isolation (use in new code)
- `idFromName()` helper converts team names to HTML-safe IDs
- View Transitions API for page navigation polish
- Speculation Rules for prerendering linked pages
- Intersection Observer for scroll-triggered `.visible` class animations

## Style Conventions
- CSS: kebab-case classes, BEM-like for hero section, `clamp()` for responsive type
- JS: camelCase, functional array methods (`forEach`, `map`, `sort`)
- Commits: descriptive, informal
- Variable naming: `:root` block defines `--bg`, `--fg`, `--muted`, `--accent`, `--accent2`, `--card`, `--border`, `--glass`, `--good`, `--bad`, `--warn`

## AI Writing Staff (Content Pipeline)

### Architecture
Bill Simmons-style AI writers generate weekly columns from Sleeper data. Three slash commands form the pipeline:

1. **`/write-week N`** — Writer agent: generates essay, 12 power ranking blurbs, confessionals, mailbag, bits, matchup picks
2. **`/edit-week N`** — Editor-in-Chief: quality gate (data accuracy, voice score, variety, continuity, tone)
3. **`/render-week N`** — Renderer: produces self-contained HTML page matching `week1.html` template

### Content Files
| Path | Purpose |
|------|---------|
| `content/voice-bible.md` | Master style guide — 12 Simmons DNA patterns, Jailyard lexicon, templates, anti-patterns |
| `content/team-profiles.json` | All 12 teams: preseason rank, tier, roast, key players, full preseason essay text |
| `content/weeks/weekN_data.json` | AI-ready data per week (matchups, standings, awards, context) — 18 files |
| `content/weeks/weekN_content.json` | Generated content per week (essay, rankings, mailbag, bits, picks) |
| `scripts/extract_week_data.py` | Transforms `season_combined.json` → per-week AI-ready JSON |

### Workflow
```bash
# 1. Fetch data (already done for 2025, all 18 weeks)
python fetch_sleeper.py --season 2025

# 2. Extract week data (already done for all 18 weeks)
python scripts/extract_week_data.py --week N --pretty
python scripts/extract_week_data.py --all

# 3. Generate content
/write-week N     # → content/weeks/weekN_content.json

# 4. Review
/edit-week N      # → APPROVE / REVISE / REJECT

# 5. Render to HTML
/render-week N    # → weekN.html + config.js nav update
```

### Voice Bible Key Rules
- Write in **second person** ("you") for team blurbs — always TO the owner, never about them
- **Group chat is a character** — reference it at least 3x per column
- **Data as punctuation** — stats embedded in narrative, never standalone
- **Every section ends with a kicker line** — memorable closer
- **Never hallucinate stats** — every number must come from week data JSON
- **Playful roasts only** — make owners laugh, never wince
- See `content/voice-bible.md` for full 12-pattern guide

### Current Status
- 2025 data: ALL 18 weeks fetched and extracted (data/ and content/weeks/)
- League history: 2022-2026, 392 matchups, Elo ratings computed
- Week 1 content: DRAFT generated (`content/weeks/week1_content.json`) — needs voice calibration
- Remaining: Compare Week 1 draft to existing `week1.html`, calibrate voice, then generate Weeks 2-18

### Python Note (Windows)
Use `python` not `python3` on this machine. Python is at:
`C:\Users\blake\AppData\Local\Programs\Python\Python312\python`

## Common Tasks
- **Generate weekly column:** `/write-week N` → `/edit-week N` → `/render-week N`
- **New weekly column (manual):** Copy `week1.html` → `week2.html`, update content + nav links
- **Update rankings:** Modify `league.teams[]` in `preseason.html`, adjust `rank` values
- **Refresh data:** `python fetch_sleeper.py --all` then commit `data/`
- **Extract week data:** `python scripts/extract_week_data.py --week N --pretty`
- **Add chart:** Canvas 2D pattern from `preseason.html`, always handle `devicePixelRatio`
- **Test changes:** Open in browser, check responsive, verify Canvas renders, test theme toggle

## Environment
- No env vars, no secrets, no build commands
- Local dev: `python -m http.server 8000` or open HTML directly
- Python: use `python` not `python3` (Windows)
- GitHub Actions runs `fetch_sleeper.py` automatically on NFL Sundays
